# 사용자-부서 관계

## 소속 유형
1. 본사 부서 소속
   - [[03_본사/부서/재무부]]
   - [[03_본사/부서/설계부]]
   - [[03_본사/부서/영업부]]
   - [[03_본사/부서/공무부]]

2. 현장 소속
   - [[03_본사/현장/현장목록]]
   - 현장별 특화 역할

3. 분점 소속
   - [[03_본사/분점/분점목록]]
   - 분점별 특화 역할

## DB 연계
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    username VARCHAR(50) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    department_id UUID REFERENCES departments(id),
    site_id UUID REFERENCES sites(id),
    branch_id UUID REFERENCES branches(id),
    role_id UUID REFERENCES roles(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

## 소속 규칙
1. 단일 소속
   - 사용자는 한 번에 하나의 부서/현장/분점에만 소속 가능
   - department_id, site_id, branch_id 중 하나만 값 가짐

2. 소속 변경
   - 소속 변경 시 이력 관리
   - 권한 자동 조정

3. 임시 소속
   - 프로젝트 기반 임시 소속 가능
   - 기간 제한 설정

## 권한 연계
- [[권한]] 문서 참조
- 소속에 따른 기본 권한 자동 부여
- 추가 권한 수동 부여 가능

## 조회 방법
1. 부서별 사용자 조회
```sql
SELECT u.* FROM users u
JOIN departments d ON u.department_id = d.id
WHERE d.name = '부서명';
```

2. 현장별 사용자 조회
```sql
SELECT u.* FROM users u
JOIN sites s ON u.site_id = s.id
WHERE s.name = '현장명';
```

3. 분점별 사용자 조회
```sql
SELECT u.* FROM users u
JOIN branches b ON u.branch_id = b.id
WHERE b.name = '분점명';
``` 